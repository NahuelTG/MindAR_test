/* Prevenir que el canvas de MindAR interfiera */
#mindar-container canvas {
  pointer-events: none !important;
}

/* Solo permitir interacción con el canvas de Three.js */
#mindar-container canvas:last-child {
  pointer-events: auto !important;
}

/* Estilos para el modo AR - SOLO cuando la clase ar-active está presente */
body.ar-active {
  margin: 0;
  padding: 0;
  overflow: hidden;
  position: fixed;
  width: 100vw;
  height: 100vh;
}

/* Asegurar que el contenedor AR ocupe toda la pantalla */
.ar-container {
  position: fixed !important;
  top: 0 !important;
  left: 0 !important;
  width: 100vw !important;
  height: 100vh !important;
  overflow: hidden !important;
  z-index: 1000;
}

/* Estilos mejorados para el video de la cámara - CONFIGURACIÓN BASE */
.ar-container video {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  object-fit: cover !important;
  object-position: center !important;
  z-index: 1;
  /* Las dimensiones se establecen dinámicamente por JavaScript */
}

/* Estilos para el canvas de Three.js */
.ar-container canvas {
  position: absolute !important;
  top: 0 !important;
  left: 0 !important;
  width: 100% !important;
  height: 100% !important;
  object-fit: cover !important;
  object-position: center !important;
  z-index: 2;
}

/* Prevenir zoom en dispositivos móviles SOLO en modo AR */
.ar-container * {
  user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
  -webkit-tap-highlight-color: transparent;
}

/* Configuración específica para móviles */
@media (max-width: 768px) {
  body.ar-active {
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
    right: 0 !important;
    bottom: 0 !important;
    width: 100vw !important;
    height: 100vh !important;
    min-height: 100vh !important;
    max-height: 100vh !important;
  }

  .ar-container {
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
    right: 0 !important;
    bottom: 0 !important;
    width: 100vw !important;
    height: 100vh !important;
    min-height: 100vh !important;
    max-height: 100vh !important;
  }

  /* Configuración específica para video en móviles - MUY IMPORTANTE */
  .ar-container video {
    position: absolute !important;
    top: 50% !important;
    left: 50% !important;
    transform: translate(-50%, -50%) !important;
    object-fit: cover !important;
    object-position: center !important;
    z-index: 1 !important;
    /* Dimensiones dinámicas controladas por JavaScript */
    min-width: 100vw !important;
    min-height: 100vh !important;
  }

  /* Configuración específica para la escena AR */
  .ar-scene-capture-target {
    touch-action: none;
    -webkit-touch-callout: none;
    -webkit-user-select: none;
    user-select: none;
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
    width: 100vw !important;
    height: 100vh !important;
    z-index: 1000;
  }

  /* Estilos para canvas y video en la escena */
  .ar-scene-capture-target canvas {
    width: 100% !important;
    height: 100% !important;
    object-fit: cover !important;
    object-position: center !important;
    display: block !important;
    position: absolute !important;
    top: 0 !important;
    left: 0 !important;
  }

  .ar-scene-capture-target video {
    position: absolute !important;
    top: 50% !important;
    left: 50% !important;
    transform: translate(-50%, -50%) !important;
    object-fit: cover !important;
    object-position: center !important;
    z-index: 1 !important;
    /* Las dimensiones se controlan por JavaScript para evitar distorsión */
  }

  /* Prevenir el bounce en iOS */
  .ar-scene-capture-target,
  .ar-scene-capture-target * {
    overscroll-behavior: none;
    -webkit-overflow-scrolling: touch;
  }

  /* Estilos para el preview de fotos mejorado */
  .photo-preview-overlay {
    position: fixed !important;
    top: 0 !important;
    left: 0 !important;
    width: 100vw !important;
    height: 100vh !important;
    z-index: 10001 !important;
    padding: 10px !important;
    box-sizing: border-box !important;
  }

  .photo-preview-container {
    width: 95% !important;
    max-width: 100% !important;
    max-height: 90% !important;
    margin: 0 auto !important;
    display: flex !important;
    flex-direction: column !important;
    justify-content: center !important;
  }

  .photo-preview-image {
    width: 100% !important;
    height: auto !important;
    max-height: 60vh !important;
    object-fit: contain !important;
    margin: 0 auto !important;
    display: block !important;
  }

  /* Botones más grandes en móviles con mejor espaciado */
  .mobile-button {
    min-height: 44px !important;
    min-width: 44px !important;
    padding: 12px 16px !important;
    font-size: 14px !important;
    touch-action: manipulation !important;
    margin: 4px !important;
  }

  /* Asegurar que los controles no se superpongan en móviles */
  .mobile-controls-spacing {
    margin-bottom: 80px !important;
  }

  /* Estilo para botones de control en móviles */
  .mobile-control-button {
    min-height: 48px !important;
    min-width: 48px !important;
    padding: 8px 12px !important;
    font-size: 12px !important;
    line-height: 1.2 !important;
  }
}

/* Configuración específica para diferentes orientaciones - MEJORADO */
@media screen and (max-width: 768px) and (orientation: portrait) {
  .ar-container video,
  .ar-scene-capture-target video {
    /* En portrait, las dimensiones se controlan por JavaScript */
    /* para mantener el aspect ratio correcto */
  }
}

@media screen and (max-width: 768px) and (orientation: landscape) {
  body.ar-active .ar-scene-capture-target {
    height: 100vh !important;
    width: 100vw !important;
  }

  body.ar-active .photo-preview-image {
    max-height: 70vh !important;
  }

  .ar-container video,
  .ar-scene-capture-target video {
    /* En landscape, las dimensiones se controlan por JavaScript */
    /* para evitar distorsión */
  }
}

/* Para dispositivos con notch SOLO en modo AR */
@supports (padding-top: env(safe-area-inset-top)) {
  body.ar-active .ar-container {
    padding-top: env(safe-area-inset-top);
    padding-bottom: env(safe-area-inset-bottom);
    padding-left: env(safe-area-inset-left);
    padding-right: env(safe-area-inset-right);
  }
}

/* Ocultar la barra de direcciones en móviles SOLO en modo AR */
@media screen and (max-width: 768px) {
  body.ar-active .ar-container {
    /* Utilizar la altura de la ventana real */
    height: 100dvh !important; /* dynamic viewport height */
  }

  /* Configuración básica para móviles SOLO en modo AR */
  body.ar-active {
    width: 100%;
    height: 100%;
    margin: 0;
    padding: 0;
    overflow: hidden;
    position: fixed;
    -webkit-overflow-scrolling: touch;
    overscroll-behavior: none;
  }

  /* Prevenir zoom en iOS SOLO en modo AR */
  body.ar-active * {
    -webkit-text-size-adjust: 100%;
    -webkit-tap-highlight-color: transparent;
    -webkit-touch-callout: none;
    -webkit-user-select: none;
    user-select: none;
  }
}

/* Configuración específica para iOS SOLO en modo AR */
@supports (-webkit-touch-callout: none) {
  body.ar-active .ar-scene-capture-target {
    height: -webkit-fill-available !important;
  }

  /* Evitar el zoom en inputs SOLO en modo AR */
  body.ar-active input,
  body.ar-active select,
  body.ar-active textarea {
    font-size: 16px !important;
  }

  /* Configuración específica para video en iOS */
  body.ar-active .ar-container video,
  body.ar-active .ar-scene-capture-target video {
    -webkit-transform: translate(-50%, -50%) !important;
    transform: translate(-50%, -50%) !important;
  }
}

/* Configuración para Android SOLO en modo AR */
@media screen and (max-width: 768px) {
  body.ar-active .ar-scene-capture-target {
    height: calc(100vh - env(keyboard-inset-height, 0px)) !important;
  }
}

/* Estilos para el loading screen en móviles */
@media screen and (max-width: 768px) {
  .loading-screen {
    padding: 20px !important;
    text-align: center !important;
  }

  .loading-screen h2 {
    font-size: 1.5rem !important;
  }

  .loading-screen p {
    font-size: 0.9rem !important;
  }
}

/* Asegurar que el body normal permita scroll cuando NO está en modo AR */
body:not(.ar-active) {
  overflow: auto;
  position: relative;
  min-height: 100vh;
}

/* Estilos específicos para dispositivos con aspect ratios problemáticos - MEJORADO */
@media screen and (max-width: 768px) and (max-aspect-ratio: 1/2) {
  /* Dispositivos muy altos (como iPhone X/11/12/13/14 Pro Max) */
  /* Las dimensiones se controlan por JavaScript */
}

@media screen and (max-width: 768px) and (min-aspect-ratio: 2/1) {
  /* Dispositivos muy anchos en landscape */
  /* Las dimensiones se controlan por JavaScript */
}

/* Nuevos estilos para debug de cámara */
.camera-debug-info {
  position: fixed;
  bottom: 4px;
  left: 4px;
  z-index: 50;
  background: rgba(0, 0, 0, 0.9);
  color: white;
  padding: 8px;
  border-radius: 4px;
  font-family: monospace;
  font-size: 10px;
  max-width: 200px;
  backdrop-filter: blur(5px);
}

/* Indicador visual para aspect ratio correcto */
.aspect-ratio-indicator {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  pointer-events: none;
  z-index: 10;
}

.aspect-ratio-indicator.correct {
  color: #4ade80;
}

.aspect-ratio-indicator.incorrect {
  color: #f87171;
}

/* Estilos para mejorar la captura de fotos */
.capture-helper {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: 5;
}

/* Overlay para mostrar el área de captura */
.capture-overlay {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  border: 2px dashed rgba(255, 255, 255, 0.5);
  box-sizing: border-box;
  pointer-events: none;
  z-index: 10;
}
